<!DOCTYPE html>
<html>
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link type="text/css", rel="stylesheet" href="style.css" /> 
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
   <script src="https://cdn.jsdelivr.net/pyodide/v0.20.0/full/pyodide.js"></script>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/1.0.21/jquery.csv.min.js"></script>
   <script src="https://cdn.plot.ly/plotly-2.1.0.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.1.5/purify.js" integrity="sha512-H+0buHbolflDvyVXCBa2dGPlz8aDXXQ1ynVFKEsz5rZolkJ9kuxqoNkmt7Yxzw6pZmvGO0wKx0jQsikSkqccXg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.js" integrity="sha512-zPMZ/3MBK+R1rv6KcBFcf7rGwLnKS+xtB2OnWkAxgC6anqxlDhl/wMWtDbiYI4rgi/NrCJdXrmNGB8pIq+slJQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
   <script src="main.js" type="text/javascript"></script>
</head>

<script>
    window.jsPDF = window.jspdf.jsPDF;
    function print(){
        var doc = new jsPDF();
        var img2;
        var pageGap = 10;
        doc.setFont('helvetica');
        doc.setFontSize(12);

        doc.text('SEND analysis tool', 10, 10)

        var img = new Image()
        var img1
        img.src = 'images/DTI full png.png'
        doc.addImage(img, 'png', 10, 78, 12, 15)

        html2canvas(document.getElementById("plot")).then(function (canvas) {

            img2 = canvas.toDataURL("image/png")
            doc.addImage(img2, 'PNG', 10, 150, 190, 100);

            doc.save("plots.pdf");
      });

    }   

    function run_js() {
        $(".spinner").removeClass('d-none');
        run_python()
    }
    // function pdfFunction() {
    //     var doc = new jsPDF('a4')  

    //     var img = new Image()
    //     var img1
    //     img.src = 'images/DTI full png.png'
    //     doc.addImage(img, 'png', 10, 78, 12, 15)

    //     html2canvas(document.plot)
    //         .then(function (canvas) {
    //             doc.addPage();
    //             img1 = canvas.toDataURL("image/png")
    //             doc.addImage(img1, 'PNG', 10, 20, 190, 100)
    //             doc.save("CanvasJS Charts.pdf");
    //         });

    //     // doc.text('SEND analysis tool', 10, 10)
    //     // doc.output("dataurlnewwindow")
    //   }
</script>

<body class="bg-white">
<div id="submit"><input type="submit" value="Submit" class="btn btn-primary" onclick="run_js()"></div>
<div class="spinner d-none" >
    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
    Loading...
</div> 
<button id="print" type="button" class="btn btn-primary d-none" onclick="print()">Save to pdf</button>

<div id="plot"></div>

</body>